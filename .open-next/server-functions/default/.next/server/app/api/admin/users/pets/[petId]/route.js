(()=>{var e={};e.id=2036,e.ids=[2036],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},75015:(e,t,s)=>{"use strict";s.r(t),s.d(t,{patchFetch:()=>x,routeModule:()=>p,serverHooks:()=>f,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>m});var r={};s.r(r),s.d(r,{DELETE:()=>d,PATCH:()=>c});var a=s(40685),n=s(97626),o=s(93465),i=s(64764),u=s(46674);async function c(e,{params:t}){let{petId:s}=await t;try{let t=await e.json(),{data:r,error:a}=await u.L.from("pets").select("*").eq("id",s).single();if(a||!r)return i.NextResponse.json({success:!1,message:"Pet not found."},{status:404});let n=new Date,o=t.subscribed_at?new Date(t.subscribed_at):r.subscribed_at?new Date(r.subscribed_at):null,c=t.subscription_expires_at?new Date(t.subscription_expires_at):r.subscription_expires_at?new Date(r.subscription_expires_at):null,d=r.subscription_status||"none";if(c){d=c<n?"expired":"active";let e=(c.getTime()-n.getTime())/864e5;e>=0&&e<=7&&(d="grace_period")}let p={...t,subscription_status:d},{error:l}=await u.L.from("pets").update(p).eq("id",s);if(l)return console.error("❌ Pet update failed:",l),i.NextResponse.json({success:!1,message:"Failed to update pet."},{status:500});let m=o&&c?{subscribed_at:o.toISOString(),subscription_expires_at:c.toISOString(),remaining_days:Math.ceil((c.getTime()-n.getTime())/864e5),status:d}:null;return i.NextResponse.json({success:!0,message:"Pet updated successfully.",petId:s,subscriptionTimeline:m})}catch(e){return console.error("\uD83D\uDD25 Pet update route error:",e),i.NextResponse.json({success:!1,message:"Internal server error."},{status:500})}}async function d(e,{params:t}){let{petId:s}=await t;try{let{data:e,error:t}=await u.L.from("pets").select("owner_id").eq("id",s).single();if(t||!e)return i.NextResponse.json({success:!1,message:"Pet not found or already deleted."},{status:404});let{owner_id:r}=e,{count:a,error:n}=await u.L.from("pets").select("id",{count:"exact"}).eq("owner_id",r);if(n)return console.error("Pet count failed:",n),i.NextResponse.json({success:!1,message:"Failed to check pet count."},{status:500});let{error:o}=await u.L.from("pets").delete().eq("id",s);if(o)return console.error("❌ Pet delete failed:",o),i.NextResponse.json({success:!1,message:"Failed to delete pet."},{status:500});let c="Pet deleted successfully.";if(1===(a||0)){let{error:e}=await u.L.from("owners").delete().eq("id",r);e?(console.error("❌ Owner delete failed after last pet was removed:",e),c="Pet deleted successfully, but failed to delete the owner (Owner ID: "+r+")."):c="Pet and associated owner deleted successfully (owner had only one pet)."}return i.NextResponse.json({success:!0,message:c})}catch(e){return console.error("\uD83D\uDD25 Pet delete route error:",e),i.NextResponse.json({success:!1,message:"Internal server error."},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/admin/users/pets/[petId]/route",pathname:"/api/admin/users/pets/[petId]",filename:"route",bundlePath:"app/api/admin/users/pets/[petId]/route"},resolvedPagePath:"/home/chinnu/projects/chipthem/src/app/api/admin/users/pets/[petId]/route.ts",nextConfigOutput:"standalone",userland:r}),{workAsyncStorage:l,workUnitAsyncStorage:m,serverHooks:f}=p;function x(){return(0,o.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:m})}},63814:()=>{},24494:()=>{},46674:(e,t,s)=>{"use strict";s.d(t,{L:()=>r});let r=(0,s(49103).UU)("https://zwqngfcujvsaahykqisj.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY)}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[3465,3610,9103],()=>s(75015));module.exports=r})();