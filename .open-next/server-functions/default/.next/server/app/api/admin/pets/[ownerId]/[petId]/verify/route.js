(()=>{var e={};e.id=7766,e.ids=[7766],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},77598:e=>{"use strict";e.exports=require("node:crypto")},40577:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>g,routeModule:()=>c,serverHooks:()=>m,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{PATCH:()=>d});var i=r(40685),o=r(97626),n=r(93465),a=r(64764),p=r(46674),u=r(57250);async function d(e,{params:t}){let{ownerId:r,petId:s}=await t;try{let{data:e,error:t}=await p.L.from("owners").select("id, is_verified, email, full_name").eq("id",r).single();if(t||!e)return a.NextResponse.json({success:!1,message:"Owner not found."},{status:404});if(!e.is_verified){let{error:e}=await p.L.from("owners").update({is_verified:!0,status:"verified",verified_at:new Date().toISOString()}).eq("id",r);if(e)return a.NextResponse.json({success:!1,message:"Failed to verify owner."},{status:500})}let{data:i,error:o}=await p.L.from("pets").select("id, owner_id, is_verified, subscription_status, subscribed_at, subscription_expires_at, pet_name, microchip_number").eq("id",s).single();if(o||!i)return a.NextResponse.json({success:!1,message:"Pet not found."},{status:404});if(i.owner_id!==r)return a.NextResponse.json({success:!1,message:"Pet does not belong to this owner."},{status:400});let n=new Date,d=i.subscription_status,c=i.subscribed_at,l=i.subscription_expires_at,f=!1;if(!i.is_verified){if(!i.subscription_status||"Not Subscribed"===i.subscription_status){d="active",c=n.toISOString();let e=new Date(n);e.setFullYear(e.getFullYear()+1),l=e.toISOString()}let{error:e}=await p.L.from("pets").update({is_verified:!0,status:"verified",verified_at:n.toISOString(),subscription_status:d,subscribed_at:c,subscription_expires_at:l}).eq("id",s);if(e)return a.NextResponse.json({success:!1,message:"Failed to verify pet."},{status:500});f=!0}if(f&&e.email)try{await (0,u.Z)({to:e.email,subject:`‚úÖ Your pet ${i.pet_name??""} has been verified on ChipThem`,html:`
            <div style="font-family: Arial, sans-serif; padding: 20px; color: #333;">
              <h2>üéâ Hi ${e.full_name||"there"}, your pet is now verified!</h2>
              <p>Your pet registration has been <strong>successfully verified</strong> and is now active in the ChipThem system.</p>

              <div style="background: #f3f6ff; padding: 15px; border-radius: 8px; border-left: 4px solid #4f46e5;">
                <h3>üêæ Pet Details</h3>
                <p><strong>Name:</strong> ${i.pet_name||"Your pet"}</p>
                <p><strong>Microchip Number:</strong> ${i.microchip_number}</p>
                <p><strong>Status:</strong> Verified</p>
                <p><strong>Subscription:</strong> ${d||"Not Subscribed"}</p>
                ${l?`<p><strong>Valid Until:</strong> ${new Date(l).toDateString()}</p>`:""}
              </div>

              <br/>
              <p>You can manage your pet's profile and details any time from your dashboard.</p>
              <a
                href="https://chipthem.com/pologin"
                style="display: inline-block; padding: 12px 24px; background: #28a745; color: #fff; text-decoration: none; border-radius: 6px; font-weight: bold; margin-top: 8px;"
              >
                üîê Go to Owner Login
              </a>

              <br/><br/>
              <p>If you did not request this verification or believe this is a mistake, please contact support immediately.</p>
              <p>Warm regards,<br/><strong>The ChipThem Team</strong></p>
            </div>
          `})}catch(e){console.error("Failed to send verification email:",e)}return a.NextResponse.json({success:!0,message:`Owner (${r}) and pet (${s}) verified successfully with yearly subscription.`})}catch(e){return console.error(e),a.NextResponse.json({success:!1,message:"Internal server error."},{status:500})}}let c=new i.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/admin/pets/[ownerId]/[petId]/verify/route",pathname:"/api/admin/pets/[ownerId]/[petId]/verify",filename:"route",bundlePath:"app/api/admin/pets/[ownerId]/[petId]/verify/route"},resolvedPagePath:"/home/chinnu/projects/chipthem/src/app/api/admin/pets/[ownerId]/[petId]/verify/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:l,workUnitAsyncStorage:f,serverHooks:m}=c;function g(){return(0,n.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:f})}},63814:()=>{},24494:()=>{},46674:(e,t,r)=>{"use strict";r.d(t,{L:()=>s});let s=(0,r(49103).UU)("https://zwqngfcujvsaahykqisj.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY)},57250:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});let s=new(r(14950)).u(process.env.RESEND_API_KEY||"");async function i({to:e,subject:t,html:r}){try{let i=await s.emails.send({from:"ChipThem <info@chipthem.com>",to:e,subject:t,html:r});if(i.error)return console.error("‚ùå Resend API error:",i.error),!1;return console.log("‚úÖ Email sent successfully:",i.data?.id||i),!0}catch(e){return e instanceof Error?console.error("‚ùå Email send failed:",e.message):console.error("‚ùå Email send failed:",e),!1}}}};var t=require("../../../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[3465,3610,9103,4950],()=>r(40577));module.exports=s})();