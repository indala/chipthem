(()=>{var e={};e.id=3298,e.ids=[3298],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},77598:e=>{"use strict";e.exports=require("node:crypto")},97449:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>v,routeModule:()=>p,serverHooks:()=>m,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>g});var i={};t.r(i),t.d(i,{PATCH:()=>d});var s=t(40685),n=t(97626),a=t(93465),o=t(64764),c=t(46674),u=t(64832),l=t(57250);async function d(e,{params:r}){let{vetId:t}=await r;try{let{data:e,error:r}=await c.L.from("veterinary_clinics").select("id, is_verified, subscription_status, subscribed_at, subscription_expires_at, google_maps_url, latitude, longitude, email, clinic_name").eq("id",t).single();if(r||!e)return o.NextResponse.json({success:!1,message:"Veterinary clinic not found."},{status:404});let i=new Date,s=e.subscription_status,n=e.subscribed_at,a=e.subscription_expires_at,d=!1;if(!e.is_verified){if(!e.subscription_status||"Not Subscribed"===e.subscription_status){s="active",n=i.toISOString();let e=new Date(i);e.setFullYear(e.getFullYear()+1),a=e.toISOString()}let r=e.latitude,l=e.longitude;if(e.google_maps_url&&(!r||!l))try{let{lat:t,lng:i}=await (0,u.e)(e.google_maps_url);r=t,l=i}catch(e){console.error("Failed to get lat/lng from Google Maps URL:",e)}let{error:p}=await c.L.from("veterinary_clinics").update({is_verified:!0,status:"verified",verified_at:i.toISOString(),subscription_status:s,subscribed_at:n,subscription_expires_at:a,latitude:r,longitude:l}).eq("id",t);if(p)return console.error("Error updating vet:",p),o.NextResponse.json({success:!1,message:"Failed to verify veterinary clinic."},{status:500});d=!0}if(d&&e.email)try{await (0,l.Z)({to:e.email,subject:`‚úÖ Your veterinary clinic "${e.clinic_name??""}" is now verified on ChipThem`,html:`
            <div style="font-family: Arial, sans-serif; padding: 20px; color: #333;">
              <h2>üéâ Congratulations${e.clinic_name?`, ${e.clinic_name}`:""}!</h2>
              <p>Your veterinary clinic has been <strong>successfully verified</strong> and activated on ChipThem.</p>

              <div style="background: #f3f6ff; padding: 15px; border-radius: 8px; border-left: 4px solid #4f46e5;">
                <h3>üè• Clinic Details</h3>
                <p><strong>Name:</strong> ${e.clinic_name||"Your clinic"}</p>
                <p><strong>Status:</strong> Verified</p>
                <p><strong>Subscription:</strong> ${s||"Not Subscribed"}</p>
                ${a?`<p><strong>Valid Until:</strong> ${new Date(a).toDateString()}</p>`:""}
              </div>

              <br/>
              <p>You can now access your clinic dashboard, manage listings, and handle pet verifications.</p>
              <a
                href="https://chipthem.com/vlogin"
                style="display: inline-block; padding: 12px 24px; background: #28a745; color: #fff; text-decoration: none; border-radius: 6px; font-weight: bold; margin-top: 8px;"
              >
                üîê Go to Clinic Login
              </a>

              <br/><br/>
              <p>If you did not request this verification or believe this is a mistake, please contact support immediately.</p>
              <p>Best regards,<br/><strong>The ChipThem Team</strong></p>
            </div>
          `})}catch(e){console.error("Failed to send vet verification email:",e)}return o.NextResponse.json({success:!0,message:`Veterinary clinic (${t}) verified successfully with yearly subscription.`})}catch(e){return console.error("Vet verify route error:",e),o.NextResponse.json({success:!1,message:"Internal server error."},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/admin/veterinary/[vetId]/verify/route",pathname:"/api/admin/veterinary/[vetId]/verify",filename:"route",bundlePath:"app/api/admin/veterinary/[vetId]/verify/route"},resolvedPagePath:"/home/chinnu/projects/chipthem/src/app/api/admin/veterinary/[vetId]/verify/route.ts",nextConfigOutput:"standalone",userland:i}),{workAsyncStorage:f,workUnitAsyncStorage:g,serverHooks:m}=p;function v(){return(0,a.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:g})}},63814:()=>{},24494:()=>{},64832:(e,r,t)=>{"use strict";async function i(e){return(await fetch(e,{redirect:"follow"})).url}async function s(e){let r=function(e){let r=e.match(/!3d(-?\d+(\.\d+)?)!4d(-?\d+(\.\d+)?)/);if(r)return{lat:Number(r[1]),lng:Number(r[3])};let t=e.match(/@(-?\d+(\.\d+)?),(-?\d+(\.\d+)?)/);return t?{lat:Number(t[1]),lng:Number(t[3])}:null}(await i(e));if(!r)throw Error("Latitude & longitude not found in Google Maps URL");return r}t.d(r,{e:()=>s})},46674:(e,r,t)=>{"use strict";t.d(r,{L:()=>i});let i=(0,t(49103).UU)("https://zwqngfcujvsaahykqisj.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY)},57250:(e,r,t)=>{"use strict";t.d(r,{Z:()=>s});let i=new(t(14950)).u(process.env.RESEND_API_KEY||"");async function s({to:e,subject:r,html:t}){try{let s=await i.emails.send({from:"ChipThem <info@chipthem.com>",to:e,subject:r,html:t});if(s.error)return console.error("‚ùå Resend API error:",s.error),!1;return console.log("‚úÖ Email sent successfully:",s.data?.id||s),!0}catch(e){return e instanceof Error?console.error("‚ùå Email send failed:",e.message):console.error("‚ùå Email send failed:",e),!1}}}};var r=require("../../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[3465,3610,9103,4950],()=>t(97449));module.exports=i})();