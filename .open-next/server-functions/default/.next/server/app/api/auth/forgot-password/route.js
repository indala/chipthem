(()=>{var e={};e.id=7556,e.ids=[7556],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},77598:e=>{"use strict";e.exports=require("node:crypto")},62090:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>g,routeModule:()=>w,serverHooks:()=>y,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{POST:()=>h});var a=r(40685),o=r(97626),i=r(93465),n=r(64764),d=r(20762),c=r(46674),p=r(59190),l=r(57250);let u=new TextEncoder().encode(process.env.JWT_SECRET);async function h(e){try{let{email:t,role:r}=await e.json();if(!t||!r)return n.NextResponse.json({message:"Missing fields"},{status:400});let s=p.X[r];if(!s)return n.NextResponse.json({message:"Invalid role"},{status:400});let{data:a,error:o}=await c.L.from(s.table).select(`${s.idCol}, email`).eq("email",t.trim().toLowerCase()).maybeSingle();if(o||!a)return n.NextResponse.json({message:"Email not found"},{status:404});let i=await new d.P({userId:a[s.idCol],role:r,email:a.email}).setProtectedHeader({alg:"HS256"}).setExpirationTime("15m").sign(u),h=`https://chipthem.com//reset-password?token=${i}`;return await (0,l.Z)({to:t,subject:"Password Reset Request",html:`<p>Click the link below to reset your password:</p>
             <a href="${h}" target="_blank">Reset Password</a>
             <p>This link will expire in 15 minutes.</p>`}),n.NextResponse.json({message:"Reset link sent to email"})}catch(e){return console.error(e),n.NextResponse.json({message:"Server error"},{status:500})}}let w=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/auth/forgot-password/route",pathname:"/api/auth/forgot-password",filename:"route",bundlePath:"app/api/auth/forgot-password/route"},resolvedPagePath:"/home/chinnu/projects/chipthem/src/app/api/auth/forgot-password/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:m,workUnitAsyncStorage:f,serverHooks:y}=w;function g(){return(0,i.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:f})}},63814:()=>{},24494:()=>{},59190:(e,t,r)=>{"use strict";r.d(t,{X:()=>s});let s={admin:{table:"admins",passwordCol:"password_hash",idCol:"id"},veterinary:{table:"veterinary_clinics",passwordCol:"password_hash",idCol:"id"},petOwner:{table:"owners",passwordCol:"password_hash",idCol:"id"}}},46674:(e,t,r)=>{"use strict";r.d(t,{L:()=>s});let s=(0,r(49103).UU)("https://zwqngfcujvsaahykqisj.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY)},57250:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});let s=new(r(14950)).u(process.env.RESEND_API_KEY||"");async function a({to:e,subject:t,html:r}){try{let a=await s.emails.send({from:"ChipThem <info@chipthem.com>",to:e,subject:t,html:r});if(a.error)return console.error("❌ Resend API error:",a.error),!1;return console.log("✅ Email sent successfully:",a.data?.id||a),!0}catch(e){return e instanceof Error?console.error("❌ Email send failed:",e.message):console.error("❌ Email send failed:",e),!1}}},20762:(e,t,r)=>{"use strict";r.d(t,{P:()=>y});var s=r(15119),a=r(45658),o=r(28993),i=r(25848);let n=async(e,t,r)=>{let s=await (0,i.A)(e,t,"sign");return(0,o.A)(e,s),new Uint8Array(await crypto.subtle.sign((0,a.A)(e,s.algorithm),s,r))};var d=r(90591),c=r(94700),p=r(93976),l=r(49621),u=r(39441),h=r(41009);class w{#e;#t;#r;constructor(e){if(!(e instanceof Uint8Array))throw TypeError("payload must be an instance of Uint8Array");this.#e=e}setProtectedHeader(e){if(this.#t)throw TypeError("setProtectedHeader can only be called once");return this.#t=e,this}setUnprotectedHeader(e){if(this.#r)throw TypeError("setUnprotectedHeader can only be called once");return this.#r=e,this}async sign(e,t){let r;if(!this.#t&&!this.#r)throw new c.Ye("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!(0,d.A)(this.#t,this.#r))throw new c.Ye("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let a={...this.#t,...this.#r},o=(0,u.A)(c.Ye,new Map([["b64",!0]]),t?.crit,this.#t,a),i=!0;if(o.has("b64")&&"boolean"!=typeof(i=this.#t.b64))throw new c.Ye('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:w}=a;if("string"!=typeof w||!w)throw new c.Ye('JWS "alg" (Algorithm) Header Parameter missing or invalid');(0,l.A)(w,e,"sign");let m=this.#e;i&&(m=p.Rd.encode((0,s.l)(m))),r=this.#t?p.Rd.encode((0,s.l)(JSON.stringify(this.#t))):p.Rd.encode("");let f=(0,p.xW)(r,p.Rd.encode("."),m),y=await (0,h.A)(e,w),g=await n(w,y,f),H={signature:(0,s.l)(g),payload:""};return i&&(H.payload=p.D0.decode(m)),this.#r&&(H.header=this.#r),this.#t&&(H.protected=p.D0.decode(r)),H}}class m{#s;constructor(e){this.#s=new w(e)}setProtectedHeader(e){return this.#s.setProtectedHeader(e),this}async sign(e,t){let r=await this.#s.sign(e,t);if(void 0===r.payload)throw TypeError("use the flattened module for creating JWS with b64: false");return`${r.protected}.${r.payload}.${r.signature}`}}var f=r(61749);class y{#t;#a;constructor(e={}){this.#a=new f.c(e)}setIssuer(e){return this.#a.iss=e,this}setSubject(e){return this.#a.sub=e,this}setAudience(e){return this.#a.aud=e,this}setJti(e){return this.#a.jti=e,this}setNotBefore(e){return this.#a.nbf=e,this}setExpirationTime(e){return this.#a.exp=e,this}setIssuedAt(e){return this.#a.iat=e,this}setProtectedHeader(e){return this.#t=e,this}async sign(e,t){let r=new m(this.#a.data());if(r.setProtectedHeader(this.#t),Array.isArray(this.#t?.crit)&&this.#t.crit.includes("b64")&&!1===this.#t.b64)throw new c.Dp("JWTs MUST NOT use unencoded payload");return r.sign(e,t)}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4141,3610,9103,5457,4950],()=>r(62090));module.exports=s})();