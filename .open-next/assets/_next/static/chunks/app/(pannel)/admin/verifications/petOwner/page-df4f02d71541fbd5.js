(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7914],{17537:(e,t,s)=>{Promise.resolve().then(s.bind(s,50304))},50304:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>b});var i=s(22194),r=s(4346),n=s(37439),a=s(2179);let l=(0,n.v)((e,t)=>({pets:[],page:1,hasMore:!0,loading:!1,error:null,fetchPets:async function(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(t().loading)return;e({loading:!0,error:null});let i=s?1:t().page;try{let a=await fetch("/api/admin/pets?page=".concat(i)),l=await a.json();if(l.success){var r,n;e({pets:s?l.pets:[...t().pets,...l.pets],page:i+1,hasMore:null!==(n=null===(r=l.pagination)||void 0===r?void 0:r.hasMore)&&void 0!==n&&n,loading:!1})}else e({loading:!1,error:l.message})}catch(t){console.error("❌ Fetch pets failed:",t),e({loading:!1,error:"Failed to fetch pets."})}},verifyPet:async(s,i)=>{try{let r=await fetch("/api/admin/pets/".concat(s,"/").concat(i,"/verify"),{method:"PATCH"}),n=await r.json();if(!n.success)throw Error(n.message);e({pets:t().pets.filter(e=>e.id!==i)})}catch(e){console.error("❌ Verify pet failed:",e)}},rejectPet:async(s,i)=>{try{let r=await fetch("/api/admin/pets/".concat(s,"/").concat(i,"/reject"),{method:"DELETE"}),n=await r.json();if(!n.success)throw Error(n.message);e({pets:t().pets.filter(e=>e.id!==i)})}catch(e){console.error("❌ Reject pet failed:",e)}},subscribeRealtime:()=>{let s=a.m.channel("realtime:pets").on("system",{event:"postgres_changes",schema:"public",table:"pets"},s=>{let{eventType:i,new:r,old:n}=s,a=[...t().pets];switch(i){case"INSERT":r&&!a.some(e=>e.id===r.id)&&e({pets:[r,...a]});break;case"UPDATE":r&&e({pets:a.map(e=>e.id===r.id?{...e,...r}:e)});break;case"DELETE":n&&e({pets:a.filter(e=>e.id!==n.id)})}}).subscribe();return()=>a.m.removeChannel(s)}}));var o=s(26916),c=s(16386),d=s(64622),u=s(91665),m=s(19159);let f=e=>{let{onClick:t,disabled:s,variant:r,size:n,children:a,className:l=""}=e,o="font-semibold rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 ";return"sm"===n?o+="px-3 py-1 text-sm ":o+="px-4 py-2 ","success"===r?o+="bg-green-600 hover:bg-green-700 text-white focus:ring-green-300":"danger"===r?o+="bg-red-600 hover:bg-red-700 text-white focus:ring-red-300":"outline-primary"===r?o+="border border-indigo-500 text-indigo-600 hover:bg-indigo-50 focus:ring-indigo-200":o+="bg-gray-200 hover:bg-gray-300 text-gray-800 focus:ring-gray-300",s&&(o+=" opacity-50 cursor-not-allowed"),(0,i.jsx)("button",{onClick:t,disabled:s,className:"".concat(o," ").concat(l),children:a})};function p(e){let{pet:t,index:s,onView:n}=e,{verifyPet:a,rejectPet:p}=l(),[x,g]=(0,r.useState)(!1),h=async()=>{var e,s;if(!t.id||!(null===(e=t.owner)||void 0===e?void 0:e.id)){m.o.error("Missing pet or owner information");return}if(!x){g(!0);try{await m.o.promise(a(null===(s=t.owner)||void 0===s?void 0:s.id,t.id),{loading:"Verifying pet...",success:"Pet verified successfully!",error:"Failed to verify pet. Please try again."})}finally{g(!1)}}},y=async()=>{var e,s;if(!t.id||!(null===(e=t.owner)||void 0===e?void 0:e.id)){m.o.error("Missing pet or owner information");return}if(!x){g(!0);try{await m.o.promise(p(null===(s=t.owner)||void 0===s?void 0:s.id,t.id),{loading:"Rejecting pet...",success:"Pet rejected successfully!",error:"Failed to reject pet. Please try again."})}finally{g(!1)}}};return(0,i.jsxs)(o.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*s},className:"bg-white border border-gray-200 rounded-xl shadow-md p-4 flex flex-col justify-between h-full",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,i.jsx)("h6",{className:"font-semibold text-lg truncate mb-0 text-gray-800",children:t.pet_name}),t.is_verified?(0,i.jsx)(c.A,{className:"text-green-500",size:20}):"pending"===t.status?(0,i.jsx)(d.A,{className:"text-yellow-500",size:20}):(0,i.jsx)(u.A,{className:"text-red-500",size:20})]}),(0,i.jsx)("p",{className:"text-gray-500 text-sm mb-1",children:t.pet_type||"Unknown type"}),t.owner&&(0,i.jsxs)("p",{className:"text-gray-500 text-sm mb-3 truncate",children:["\uD83D\uDC64 ",t.owner.full_name," (",t.owner.email,")"]})]}),(0,i.jsxs)("div",{className:"flex justify-between mt-auto space-x-2 pt-3 border-t border-gray-100",children:[(0,i.jsx)(f,{size:"sm",variant:"outline-primary",onClick:()=>n(t),className:"w-1/3",children:"View"}),(0,i.jsx)(f,{size:"sm",variant:"success",disabled:t.is_verified||x,onClick:h,className:"w-1/3",children:"Accept"}),(0,i.jsx)(f,{size:"sm",variant:"danger",disabled:x,onClick:y,className:"w-1/3",children:"Reject"})]})]},t.id)}var x=s(43821);let g=()=>(0,i.jsx)(x.hW,{className:"animate-spin text-indigo-500 w-5 h-5 mr-2"}),h=e=>{let{onClick:t,disabled:s,variant:r,children:n,className:a=""}=e,l="px-6 py-3 font-semibold rounded-lg transition-all duration-200 focus:outline-none focus:ring-4 ";return"secondary"===r?l+="bg-gray-500 hover:bg-gray-600 text-white focus:ring-gray-300":"outline-secondary"===r?l+="border border-gray-300 text-gray-700 hover:bg-gray-100 focus:ring-gray-200":l+="bg-indigo-600 hover:bg-indigo-700 text-white focus:ring-indigo-300",s&&(l+=" opacity-50 cursor-not-allowed"),(0,i.jsx)("button",{type:"button",onClick:t,disabled:s,className:"".concat(l," ").concat(a," flex items-center justify-center"),children:n})},y=e=>{let{show:t,onClose:s,pet:n}=e,a=(0,r.useRef)(null),l=(0,r.useRef)(null);return((0,r.useEffect)(()=>{if(!t)return;l.current=document.activeElement;let e=e=>{if("Escape"===e.key&&s(),"Tab"===e.key&&a.current){let t=a.current.querySelectorAll('button, a, input, textarea, select, [tabindex]:not([tabindex="-1"])');if(!t.length)return;let s=t[0],i=t[t.length-1];e.shiftKey||document.activeElement!==i||(e.preventDefault(),s.focus()),e.shiftKey&&document.activeElement===s&&(e.preventDefault(),i.focus())}};return window.addEventListener("keydown",e),setTimeout(()=>{var e,t;null===(t=a.current)||void 0===t||null===(e=t.querySelector("button"))||void 0===e||e.focus()},0),()=>{var t;window.removeEventListener("keydown",e),null===(t=l.current)||void 0===t||t.focus()}},[t,s]),t)?(0,i.jsx)("div",{className:"fixed inset-0 bg-black/60 flex justify-center items-center p-4 z-50","aria-modal":"true",role:"dialog",onClick:s,children:(0,i.jsxs)("div",{ref:a,className:"bg-white rounded-xl shadow-2xl max-w-lg w-full",onClick:e=>e.stopPropagation(),children:[(0,i.jsxs)("div",{className:"flex justify-between items-center p-5 border-b",children:[(0,i.jsx)("h5",{className:"text-xl font-bold",children:"Pet Details"}),(0,i.jsx)("button",{type:"button",onClick:s,children:(0,i.jsx)(x.QCr,{className:"w-6 h-6"})})]}),(0,i.jsx)("div",{className:"p-6 max-h-[70vh] overflow-y-auto",children:n?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h5",{className:"text-2xl font-semibold mb-1",children:n.pet_name}),(0,i.jsx)("p",{className:"text-gray-500 mb-3",children:n.pet_type||"Unknown type"}),(0,i.jsxs)("div",{className:"bg-gray-100 p-3 rounded mb-4",children:[(0,i.jsx)("strong",{children:"Status:"})," ",n.status||"N/A"," –"," ",(0,i.jsx)("span",{className:n.is_verified?"text-green-600":"text-yellow-600",children:n.is_verified?"Verified":"Unverified"})]}),n.owner&&(0,i.jsxs)("div",{className:"border-t pt-4",children:[(0,i.jsxs)("h6",{className:"font-bold mb-2 flex items-center",children:[(0,i.jsx)(x.x$1,{className:"mr-2"})," Owner"]}),(0,i.jsx)("p",{children:n.owner.full_name}),(0,i.jsx)("p",{children:n.owner.email}),n.owner.phone_number&&(0,i.jsx)("p",{children:n.owner.phone_number}),n.owner.city&&(0,i.jsxs)("p",{children:[n.owner.city,", ",n.owner.country||""]})]})]}):(0,i.jsx)("div",{className:"flex justify-center py-6",children:(0,i.jsx)(g,{})})}),(0,i.jsx)("div",{className:"flex justify-end p-4 border-t",children:(0,i.jsx)(h,{variant:"secondary",onClick:s,children:"Close"})})]})}):null};function b(){let{pets:e,hasMore:t,loading:s}=l(),n=l(e=>e.fetchPets),a=l(e=>e.subscribeRealtime),[o,c]=(0,r.useState)(null),[d,u]=(0,r.useState)(!1),m=(0,r.useCallback)(e=>{n(e)},[n]),f=(0,r.useCallback)(()=>a(),[a]);(0,r.useEffect)(()=>{m(!0)},[m]),(0,r.useEffect)(()=>{let e=f();return()=>null==e?void 0:e()},[f]);let b=e=>{c(e),u(!0)};return(0,i.jsxs)("div",{className:"p-6 md:p-8 bg-gray-50 min-h-screen",children:[(0,i.jsxs)("h2",{className:"text-3xl font-bold mb-6 flex items-center",children:[(0,i.jsx)(x.O21,{className:"mr-3"})," Pet Verification"]}),(0,i.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:e.map((e,t)=>(0,i.jsx)(p,{pet:e,index:t,onView:b},e.id))}),t&&(0,i.jsx)("div",{className:"text-center mt-8",children:(0,i.jsx)(h,{onClick:()=>m(),disabled:s,variant:"outline-secondary",className:"min-w-[200px]",children:s?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(g,{})," Loading..."]}):"Load More Pets"})}),(0,i.jsx)(y,{show:d,onClose:()=>u(!1),pet:o})]})}},2179:(e,t,s)=>{"use strict";s.d(t,{m:()=>i});let i=(0,s(3830).UU)("https://zwqngfcujvsaahykqisj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp3cW5nZmN1anZzYWFoeWtxaXNqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxNTczNjYsImV4cCI6MjA3NzczMzM2Nn0.TYScA96_QA1pTsZVDty3f4fPDTJRUfbfTtVP9amTuxg")}},e=>{var t=t=>e(e.s=t);e.O(0,[2912,6916,9159,238,1829,9539,7358],()=>t(17537)),_N_E=e.O()}]);